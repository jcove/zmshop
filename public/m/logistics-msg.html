<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>物流详情</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!--标准mui.css-->
		<script src="js/use-rem.js" type="text/javascript" charset="utf-8"></script>
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" type="text/css" href="css/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="css/reset.css" />
		<!--App自定义的css-->
		<link rel="stylesheet" type="text/css" href="css/main.css" />
		<link rel="stylesheet" type="text/css" href="css/logistics-msg.css" />
	</head>

	<body style="padding: 0 0.2rem;">
		<div id="logisticsMsg" class="logistics-center" style="height: 100%;">
			<header class="mui-bar mui-bar-nav bgwhite">
				<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
				<h1 class="mui-title">{{pageTitle[language]}}</h1>
			</header>
			<div class="mui-content" style="background-color: white;border-radius: 0.1rem;margin-bottom: 0.2rem;">
				<div class="mui-content">
					<ul v-if="stores" class="mui-table-view" style="margin-top: 0;">
						<li v-for="itemin in stores" style="padding: 0 15px 11px;">
							<a :href="itemin.link" class="iteminlink">{{itemin.name}} <span class="mui-icon mui-icon-arrowright"></span></a>
							<div v-for="(itemin2,index2) in itemin.trades" class="clearfix itemsin" :style="{borderBottomWidth:(index2===itemin.trades.length-1&&0)}">
								<div class="x-col3 trade-img" :style="{backgroundImage:'url('+itemin2.img+')'}"></div>
								<div class="x-col9">
									<div class="clearfix">
										<h4 class="fl">{{itemin2.title}}</h4>
										<div class="fr tr">
											<span>{{unit[language]+itemin2.unitprice}}</span><br /><span>x {{itemin2.numbers}}</span>
										</div>
									</div>
								</div>
							</div>
							<div class="tr">
								<span style="padding-right: 0.2rem;">{{tradeText[0][language]+itemin.numbers+tradeText[1][language]}}</span>
								<span>{{tradeText[2][language]+':'}}</span><span class="pricecolor">{{unit[language]+itemin.totalprice}}</span>
							</div>
							<!--<div class="tr">
							<span v-for="(itembtn,i) in buttons" :class="'buttonstyle'+i" style="color: #3399ff;border-color: #3399ff;">{{itembtn.name}}</span>
						</div>-->
						</li>
					</ul>
					<div v-else class="mui-loading">
						<div class="mui-spinner"></div>
					</div>
				</div>
				<section id="cd-timeline" class="cd-container">
					<div v-for="item in msgs" class="cd-timeline-block">
						<div class="cd-timeline-img active" :class="{small:item.type===4}">
							<span class="iconfont" :class="iconsClassName[item.type]"></span>
						</div>
						<div class="cd-timeline-content">
							<h2>{{item.name}}</h2>
							<p v-html="item.message"></p>
							<span class="cd-date" v-html="item.time"></span>
						</div>
					</div>
					<!--<div class="progress"></div>-->
				</section>
			</div>
			<div id="startLoading" class="mui-loading" style="position: fixed;top: 0;left: 0;right: 0;bottom: 0;z-index: 2000;background-color: gainsboro;">
				<div class="mui-spinner" style="margin-top: 120px;width: 32px;height: 32px"></div>
			</div>
		</div>
		<script src="js/vue.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/axios.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/mui.min.js"></script>
		<script type="text/javascript">
			new Vue({
				el: '#logisticsMsg',
				data: {
					language: localStorage.choose,
					Axios: null,
					code: '',
					postid: '',
					pageTitle: ['物流信息','logistics information','物流情報'],
					tradeText: [
						['共', 'common', '共に'],
						['件商品', 'piece goods', 'へんしょうひん'],
						['合计', 'total', 'ごうけい']
					],
					buttons: [{
						name: ['查看物流','check logistics','物流を調べる']
					}],
					stores: [
						/*{
												name: '木子大药房',
												link: '#',
												trades: [{
													title: '时代峰峻卡进口国画的跟',
													img: 'img/trade.png',
													unitprice: 20,
													numbers: 1
												}, {
													title: '时代峰峻卡进口国画的跟',
													img: 'img/trade.png',
													unitprice: 20,
													numbers: 1
												}],
												numbers: 2,
												totalprice: 40
											}*/
					],
					msgs: [
						/*{
												type: 0,
												name: '已下单',
												message: '您的订单已开始处理',
												time: '08-24<br />24:09'
											}, {
												type: 1,
												name: '已发货',
												message: '卖家发货',
												time: '08-24<br />24:09'
											}, {
												type: 2,
												name: '已出库',
												message: '卖家发货',
												time: '08-24<br />24:09'
											}, {
												type: 3,
												name: '已揽件',
												message: '[广州市]广州中山的刘老二[<span class="orange">13548796547</span>]已揽件',
												time: '08-24<br />24:09'
											}, {
												type: 4,
												name: '',
												message: '[广州市]快件离开中山永丰已发往青岛中转部',
												time: '08-24<br />24:09'
											}, {
												type: 4,
												name: '',
												message: '[广州市]快件离开中山永丰已发往青岛中转部',
												time: '08-24<br />24:09'
											}, {
												type: 4,
												name: '',
												message: '[广州市]快件离开中山永丰已发往青岛中转部',
												time: '08-24<br />24:09'
											}, {
												type: 5,
												name: '运输中',
												message: '[青岛市]快件已到达青岛李村',
												time: '08-24<br />24:09'
											}, {
												type: 6,
												name: '派送中',
												message: '【青岛市】青岛李村派件员 张某某 <span class="orange">13548796547</span> 正在为您派件',
												time: '08-24<br />24:09'
											}, {
												type: 7,
												name: '待取件',
												message: '····························',
												time: '08-24<br />24:09'
											}, {
												type: 8,
												name: '已收货',
												message: '····························',
												time: '08-24<br />24:09'
											}*/
					],
					iconsClassName: ['icon-xiadan', 'icon-fahuo', 'icon-chuku', 'icon-lanjian', '', 'icon-yunshu', 'icon-paisong', 'icon-daishouhuo', 'icon-shouhuo'],
					unit: ['￥', '$', '￥'],
					//shops: ['商家：','Shops:','店向き:'],
				},
				computed: {
					totalPrice: function() {
						return this.unit[this.language] + (this.orders.price * this.orders.num);
					}
				},
				mounted: function() {
					document.getElementById('startLoading').style.display='none';
					var datas = JSON.parse(sessionStorage.orderitem);
					var that = this;
					console.log(datas);
					that.code = datas.express_code;
					that.postid = datas.express_sn;
					that.stores = [{
						name: datas.name,
						link: 'details.html?id=' + datas.goodsId,
						trades: [{
							title: datas.trades[0].title,
							img: datas.trades[0].img,
							unitprice: datas.trades[0].unitprice,
							numbers: datas.trades[0].numbers
						}],
						numbers: datas.trades[0].numbers,
						totalprice: datas.trades[0].totalPrice
					}];
					//翻转物流信息msgs排序
					this.msgs.reverse();
					mui.init({
						swipeBack: false
					});
					that.Axios = axios.create({
						baseURL: 'http://demo2.ruanwe.com/',
						timeout: 12000
					});
					//获取物流信息
					that.Axios.get('api/express/query', {
						params: {
							com: that.code,
							post_id: that.postid
						}
					}).then(function(r) {
						console.log(r);
						r.data.data.forEach(function(item) {
							that.msgs.unshift({
								type: 4,
								name: '',
								message: item.context,
								time: item.time.split(' ')[0] + '<br/>' + item.time.split(' ')[1]
							});
						});
					}).catch(function(error) {
						console.log(error);
					});
				}
			});
		</script>
	</body>

</html>